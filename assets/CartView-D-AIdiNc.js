import{d as V,v as z,A as B,r as p,o as W,w as j,c as D,a as l,b as n,f as t,e as b,_ as U,u as d,i as y,B as q,y as C,F as g,g as T,C as P,D as F,t as i,h as R,j as m,z as M}from"./index-DeAbvZPb.js";import{S as E,A as G}from"./autoplay-CcLt2_l8.js";import{a as O}from"./order-CLQXOnDY.js";import{a as H}from"./products-CdmBiZxz.js";const J={class:"container"},K={key:0,class:"min-vh-100 d-flex flex-column justify-content-center align-items-center"},Q={class:"my-6"},X={key:1,class:"mt-3"},Y={class:"row"},Z={class:"col-md-8"},I={class:"table"},tt={class:"border-0 px-0 py-4"},st=["src","alt"],et={class:"mb-0 fw-bold ms-3 d-inline-block"},ot={class:"border-0 align-middle",style:{"max-width":"160px"}},lt={class:"input-group pe-5"},nt=["onClick","disabled"],at=["value"],it=["onClick","disabled"],dt={class:"border-0 align-middle"},rt={class:"border-0 align-middle"},ct=["onClick","disabled"],ut={class:"input-group w-50 mb-3"},pt=["disabled"],bt={key:0,class:"text-success small mt-1"},_t={class:"col-md-4"},mt={class:"border p-4 mb-4"},ft={class:"table text-muted border-bottom"},vt={class:"text-end border-0 px-0 pt-4"},ht={key:0},yt={class:"text-end border-0 px-0 pt-2 text-success"},gt={class:"d-flex justify-content-between mt-4"},wt={class:"mb-0 h4 fw-bold"},xt={class:"my-5"},kt={class:"swiper-wrapper"},Ct={class:"card border-0 mb-4 position-relative position-relative"},Tt=["src","alt"],St={class:"card-body p-0"},$t={class:"mb-0 mt-3"},Nt={class:"card-text mb-0"},Lt={class:"text-muted"},jt=V({__name:"CartView",setup(At){const c=z(),{cart:r,isUpdating:w,isDeleting:S}=B(c),f=p([]),v=p(null);W(()=>{c.getCart(),$()}),j(()=>f.value,async a=>{a.length!==0&&(await M(),v.value&&new E(v.value,{modules:[G],loop:!0,autoplay:{delay:2500,disableOnInteraction:!1},slidesPerView:2,spaceBetween:10,breakpoints:{767:{slidesPerView:3,spaceBetween:30}}}))});const $=async()=>{try{const a=await H({page:String(1)});f.value=a.data.products}catch{alert("取得產品列表失敗")}},x=async(a,s)=>{let o=s.qty;o=a==="plus"?o+1:o-1,!(o<=0)&&c.updateCartItem({id:s.id,product_id:s.product.id,qty:o})},N=async a=>{c.deleteCartItem(a)},_=p(""),h=p(!1),u=p(!1),L=D(()=>u.value?r.value.total-r.value.final_total:0),A=async()=>{if(_.value.trim())try{h.value=!0,await O(_.value),await c.getCart(),u.value=!0}catch{alert("套用優惠券失敗，優惠券已過期或不存在"),u.value=!1}finally{h.value=!1}};return(a,s)=>{const o=q("RouterLink");return n(),l(g,null,[t("div",J,[b(U),d(r).carts.length===0?(n(),l("div",K,[s[2]||(s[2]=t("p",{class:"text-center"},"目前購物車還沒有任何商品",-1)),t("div",Q,[b(o,{to:"/products",class:"btn btn-lg btn-dark rounded-3"},{default:y(()=>[...s[1]||(s[1]=[m(" 前往逛逛 ",-1)])]),_:1})])])):(n(),l("div",X,[s[14]||(s[14]=t("h3",{class:"mt-3 mb-4"},"購物車",-1)),t("div",Y,[t("div",Z,[t("table",I,[s[6]||(s[6]=t("thead",null,[t("tr",null,[t("th",{class:"border-0 ps-0"},"產品名稱"),t("th",{class:"border-0"},"數量"),t("th",{class:"border-0"},"價格"),t("th",{class:"border-0"})])],-1)),t("tbody",null,[(n(!0),l(g,null,T(d(r).carts,e=>(n(),l("tr",{key:e.id,class:"border-bottom border-top"},[t("th",tt,[t("img",{src:e.product.imageUrl,alt:e.product.title,style:{width:"72px",height:"72px","object-fit":"cover"}},null,8,st),t("p",et,i(e.product.title),1)]),t("td",ot,[t("div",lt,[t("button",{onClick:k=>x("minus",e),disabled:e.qty===1||d(w),class:"btn btn-outline-dark border-0",type:"button"},[...s[3]||(s[3]=[t("i",{class:"fas fa-minus"},null,-1)])],8,nt),t("input",{type:"text",class:"form-control border-0 text-center",readonly:"",value:e.qty},null,8,at),t("button",{onClick:k=>x("plus",e),disabled:d(w),class:"btn btn-outline-dark border-0",type:"button"},[...s[4]||(s[4]=[t("i",{class:"fas fa-plus"},null,-1)])],8,it)])]),t("td",dt," NT$"+i(e.final_total.toLocaleString("zh-TW")),1),t("td",rt,[t("button",{onClick:k=>N(e.id),disabled:d(S),class:"btn btn-outline-dark border-0",type:"button"},[...s[5]||(s[5]=[t("i",{class:"fas fa-times"},null,-1)])],8,ct)])]))),128))])]),t("div",ut,[P(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>_.value=e),type:"text",class:"form-control border-0 border-bottom shadow-none",placeholder:"折扣碼"},null,512),[[F,_.value]]),t("button",{onClick:A,disabled:h.value,class:"btn btn-outline-dark border-0 border-bottom",type:"button"},[...s[7]||(s[7]=[t("i",{class:"fas fa-paper-plane"},null,-1)])],8,pt)]),u.value?(n(),l("p",bt,"已新增折扣")):C("",!0)]),t("div",_t,[t("div",mt,[s[12]||(s[12]=t("h4",{class:"fw-bold mb-4"},"訂單資訊",-1)),t("table",ft,[t("tbody",null,[t("tr",null,[s[8]||(s[8]=t("th",{class:"border-0 px-0 pt-4"},"小計",-1)),t("td",vt," NT$"+i(d(r).total.toLocaleString("zh-TW")),1)]),u.value?(n(),l("tr",ht,[s[9]||(s[9]=t("th",{class:"border-0 px-0 pt-2 text-success"},"折扣",-1)),t("td",yt," - NT$"+i(L.value.toLocaleString("zh-TW")),1)])):C("",!0)])]),t("div",gt,[s[10]||(s[10]=t("p",{class:"mb-0 h4 fw-bold"},"總計",-1)),t("p",wt,"NT$"+i(d(r).final_total.toLocaleString("zh-TW")),1)]),b(o,{to:"/checkout",class:"btn btn-dark w-100 mt-4"},{default:y(()=>[...s[11]||(s[11]=[m(" 前往結帳 ",-1)])]),_:1})])])]),t("div",xt,[s[13]||(s[13]=t("h3",{class:"fw-bold"},"你可能會喜歡的植栽",-1)),t("div",{ref_key:"swiperContainer",ref:v,class:"swiper mt-4 mb-5"},[t("div",kt,[(n(!0),l(g,null,T(f.value,e=>(n(),l("div",{key:e.id,class:"swiper-slide"},[t("div",Ct,[t("img",{src:e.imageUrl,class:"card-img-top object-fit-cover rounded-0",style:{height:"280px"},alt:e.title},null,8,Tt),t("div",St,[t("h4",$t,[b(o,{to:`/products/${e.id}`},{default:y(()=>[m(i(e.title),1)]),_:2},1032,["to"])]),t("p",Nt,[m(" NT$"+i(e.price.toLocaleString("zh-TW"))+" ",1),t("del",Lt," NT$"+i(e.origin_price.toLocaleString("zh-TW")),1)])])])]))),128))])],512)])]))]),b(R)],64)}}});export{jt as default};

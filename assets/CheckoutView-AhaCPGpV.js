import{d as U,r as n,v as A,A as B,o as R,c as b,a,b as o,f as e,y as i,e as S,_ as z,u as f,F as _,g as D,t as u,C as c,D as m,i as W,B as E,j as N,G as F}from"./index-DeAbvZPb.js";import{b as M,c as q}from"./order-CLQXOnDY.js";const G={class:"container"},O={class:"row justify-content-center"},H={class:"col-md-10"},J={class:"row justify-content-center"},K={class:"col-md-10"},Q={key:0,class:"fw-bold mb-4 pt-3"},X={key:1,class:"fw-bold mb-4 pt-3"},Y={class:"row flex-row-reverse justify-content-center pb-5"},Z={class:"col-md-4"},I={class:"border p-4 mb-4"},ee={class:"d-flex flex-column gap-2"},te=["src","alt"],se={class:"w-100"},le={class:"d-flex justify-content-between"},ae={class:"mb-0 fw-bold"},oe={class:"mb-0"},ne={class:"mb-0 fw-bold"},de={class:"table mt-4 border-top border-bottom text-muted"},re={class:"text-end border-0 px-0 pt-4"},ie={class:"d-flex justify-content-between mt-4"},ue={class:"mb-0 h4 fw-bold"},ce={class:"col-md-6"},me={key:0},pe={class:"mb-2"},ve={key:0,class:"text-danger small mt-1"},be={class:"mb-2"},fe={key:0,class:"text-danger small"},_e={class:"mb-2"},xe={key:0,class:"text-danger small"},ye={class:"mb-2"},he={key:0,class:"text-danger small"},we={class:"mb-2"},ge={key:1,class:"card rounded-0"},ke={class:"d-flex justify-content-between mt-4"},Ve=["disabled"],Ce=["disabled"],Te=U({__name:"CheckoutView",setup(Pe){const T=F(),d=n(1),x=A(),{cart:p}=B(x);R(()=>{x.getCart()});const y=n(null),l=n({email:"",name:"",tel:"",address:"",message:""}),r=n(!1),h=n(!1),w=b(()=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(l.value.email.trim())),g=b(()=>l.value.name.trim()!==""),k=b(()=>/^09\d{8}$/.test(l.value.tel.trim())),V=b(()=>l.value.address.trim()!==""),j=async()=>{try{h.value=!0;const{message:v,...t}=l.value,P=await q({user:t,message:v});y.value=P.data.orderId,d.value=2}catch{alert("訂單建立失敗")}finally{h.value=!1}},$=()=>{r.value=!0,!(!w.value||!g.value||!k.value||!V.value)&&j()},C=n(!1),L=async()=>{if(y.value)try{C.value=!0,await M(y.value),await x.getCart(),T.push("/checkout-success")}catch{alert("付款失敗")}finally{C.value=!1}};return(v,t)=>{const P=E("RouterLink");return o(),a("div",G,[e("div",O,[e("div",H,[S(z)])]),f(p)?.carts.length?(o(),a(_,{key:0},[e("div",J,[e("div",K,[d.value===1?(o(),a("h3",Q,"輸入結帳資訊")):(o(),a("h3",X,"選擇付款方式"))])]),e("div",Y,[e("div",Z,[e("div",I,[e("div",ee,[(o(!0),a(_,null,D(f(p).carts,s=>(o(),a("div",{key:s.id,class:"d-flex"},[e("img",{src:s.product.imageUrl,alt:s.product.title,style:{width:"48px",height:"48px","object-fit":"cover"},class:"me-2"},null,8,te),e("div",se,[e("div",le,[e("p",ae,u(s.product.title),1),e("p",oe,"NT$"+u(s.final_total.toLocaleString("zh-TW")),1)]),e("p",ne,"x"+u(s.qty),1)])]))),128))]),e("table",de,[e("tbody",null,[e("tr",null,[t[6]||(t[6]=e("th",{class:"border-0 px-0 pt-4"},"小計",-1)),e("td",re," NT$"+u(f(p).total.toLocaleString("zh-TW")),1)]),t[7]||(t[7]=e("tr",null,[e("th",{class:"border-0 px-0 pt-0 pb-4"},"付款方式"),e("td",{class:"text-end border-0 px-0 pt-0 pb-4"},"ApplePay")],-1))])]),e("div",ie,[t[8]||(t[8]=e("p",{class:"mb-0 h4 fw-bold"},"總計",-1)),e("p",ue,"NT$"+u(f(p).final_total.toLocaleString("zh-TW")),1)])])]),e("div",ce,[d.value===1?(o(),a("form",me,[e("div",pe,[t[9]||(t[9]=e("label",{for:"email",class:"text-muted mb-0"},"電子信箱",-1)),c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.email=s),type:"email",class:"form-control",id:"email",placeholder:"example@gmail.com"},null,512),[[m,l.value.email]]),!w.value&&r.value?(o(),a("span",ve," 請輸入正確的電子信箱 ")):i("",!0)]),e("div",be,[t[10]||(t[10]=e("label",{for:"name",class:"text-muted mb-0"},"姓名",-1)),c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.name=s),type:"text",class:"form-control",id:"name",placeholder:"請輸入姓名"},null,512),[[m,l.value.name]]),!g.value&&r.value?(o(),a("span",fe," 請輸入姓名 ")):i("",!0)]),e("div",_e,[t[11]||(t[11]=e("label",{for:"tel",class:"text-muted mb-0"},"手機",-1)),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.tel=s),type:"text",class:"form-control",id:"tel",placeholder:"請輸入手機"},null,512),[[m,l.value.tel]]),!k.value&&r.value?(o(),a("span",xe," 請輸入正確的手機號碼 ")):i("",!0)]),e("div",ye,[t[12]||(t[12]=e("label",{for:"address",class:"text-muted mb-0"},"地址",-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.address=s),type:"text",class:"form-control",id:"address",placeholder:"請輸入地址"},null,512),[[m,l.value.address]]),!V.value&&r.value?(o(),a("span",he," 請輸入正確的地址 ")):i("",!0)]),e("div",we,[t[13]||(t[13]=e("label",{for:"message",class:"text-muted mb-0"},"留言",-1)),c(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.message=s),class:"form-control",rows:"3",id:"message",placeholder:"有什麼要留言給我們的嗎?"},null,512),[[m,l.value.message]])])])):(o(),a("div",ge,[...t[14]||(t[14]=[e("div",{class:"card-header bg-white border-0 py-3"},[e("p",{class:"mb-0"},"Apple Pay")],-1)])])),e("div",ke,[d.value===1?(o(),a(_,{key:0},[S(P,{to:"/cart",class:"text-dark"},{default:W(()=>[...t[15]||(t[15]=[e("i",{class:"fas fa-chevron-left me-2"},null,-1),N("返回 ",-1)])]),_:1}),e("button",{onClick:$,disabled:h.value||!w.value||!g.value||!k.value||!V.value,class:"btn btn-dark px-5"}," 下一步 ",8,Ve)],64)):(o(),a(_,{key:1},[e("button",{onClick:t[5]||(t[5]=s=>d.value=1),class:"btn btn-link text-dark p-0"},[...t[16]||(t[16]=[e("i",{class:"fas fa-chevron-left me-2"},null,-1),N("返回 ",-1)])]),e("button",{onClick:L,disabled:C.value,class:"btn btn-dark px-5"}," 結帳 ",8,Ce)],64))])])])],64)):i("",!0)])}}});export{Te as default};
